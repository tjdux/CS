## 라우터
- 라우팅: 패킷이 이동할 최적의 경로를 설정한 뒤 해당 경로로 패킷을 이동시키는 것
- 라우터
  - 네트워크 계층의 핵심 기능
  - 일반적인 가정 환경에서는 공유기가 라우터의 역할
- 홉 (hop)
  - 라우팅 도중 패킷이 호스트와 라우터 간에, 혹은 라우터와 라우터 간에 이동하는 하나의 과정
  - 패킷은 여러 홉을 거쳐 라우팅
<br/>

## 라우팅 테이블
- 라우팅 테이블 (routing table)
  - 라우팅의 핵심은 라우터가 저장하고 관리하는 라우팅 테이블
    - 라우터의 라우팅 테이블: 패킷을 어디로 전달할지 결정하는 중간자 역할
    - 호스트의 라우팅 테이블: 패킷이 LAN의 내부인지 외부인지 판단하여 로컬로 보낼지 라우터로 보낼지 결정
  - 특정 수신지까지 도달하기 위한 정보를 명시한 일종의 표와 같은 정보
  - 라우터는 라우팅 테이블을 참고하여 수신지까지의 도달 경로를 판단
- 라우팅 테이블에 포함된 정보

  | 항목                     | 설명 |
  |--------------------------|------|
  | 수신지 IP 주소와 서브넷 마스크 | 최종적으로 패킷을 전달할 대상 |
  | 다음 홉 (next hop)       | - 최종 수신지까지 가기 위해 다음으로 거쳐야 할 호스트의 IP 주소나 인터페이스 <br/>- 게이트웨이라고 명시되기도 함 |
  | 네트워크 인터페이스       | - 패킷을 내보낼 통로<br/>- NIC 이름이나 인터페이스에 대응되는 IP 주소가 명시 |
  | 메트릭 (metric)          | - 해당 경로로 이동하는 데에 드는 비용<br/>- 패킷을 내보낼 경로를 선택할 때 메트릭이 낮은 경로를 선호 |

- **디폴트 라우트 (default route)**
  - 패킷을 어떤 IP 주소로 전달할지 결정하기 어려울 경우 기본적으로 패킷을 전달할 경로
  - 라우팅 테이블에 없는 경로로 패킷을 전달해야 할 때, 디폴트 라우트로 패킷을 내보냄
  - 0.0.0.0/0
  - 기본 게이트 웨이로 나가기 위한 경로
    - 기본 게이트 웨이
      - 호스트가 속한 네트워크 외부로 나가기 위한 첫 번째 경로
      - 일반적으로 라우터 주소를 의미하는 경우가 많음 
<br/>

## 정적 라우팅과 동적 라우팅
- 정적 라우팅 (static routing)
  - 사용자가 수동으로 직접 채워 넣은 라우팅 테이블의 항목을 토대로 라우팅되는 방식
- 동적 라우팅 (dynamic routing)
  - 정적 라우팅의 단점
    - 네트워크의 규모가 커지고 관리해야 할 라우터의 개수가 늘어났을 때 관리의 어려움
    - 입력 실수
    - 라우팅되는 경로상에 예상치 못한 문제 발생 가능: 경로상 문제가 발생하면 다른 경로로 우회하여 전송할 수 있음에도 문제가 되는 경로로 패킷을 전송할 수 밖에 없음
  - 동적 라우팅
    - 자동으로 라우팅 테이블 항목을 만들고, 이를 이용하여 라우팅하는 방식
    - 라우팅 테이블 항목이 수시로 변할 수 있음
    - 장점
      - 대규모 네트워크 관리에서의 편리함
      - 네트워크 경로상에 문제가 발생했을 때 이를 우회할 수 있도록 경로가 자동으로 갱신
    - 최적의 경로를 찾아 라우팅 테이블에 추가하기 위해 라우터끼리 자신의 정보를 교환 ➡️ 이 과정에서 (동적) 라우팅 프로토콜이 사용됨
<br/>

## AS (Autonomous System)
- 동일한 라우팅 정책으로 운용되는 라우터들의 집단 네트워크
- 한 회사나 단체에서 관리하는 라우터 집단
- AS마다 인터넷 상에서 고유한 AS 번호 (ASN; Autonomous System Number)가 할당
- 한 AS 내에서는 다수의 라우터가 존재: AS 내부에서만 통신 & AS 외부와의 통신 가능
- AS 경계 라우터 (ASBR; Autonomous System Boundary Router): AS 외부와 통신할 경우 AS 경계에서 AS 내외로 통신을 주고받을 수 있는 라우터
- [ 내부 라우터들 ] → [ ASBR ] ↔ [ 외부 AS ]
<br/>

## 라우팅 프로토콜 (Routing Protocol)
- 라우터끼리 자신의 정보를 교환하며 패킷이 이동할 최적의 경로를 찾기 위한 프로토콜
- 라우팅 범위에 따라 IGP, EGP
- IGP (Interior Gateway Protocol): AS 내부에서 수행
  - 1️⃣ RIP (Routing Information Protocol)
    - 거리 벡터 (distance vector) 기반의 라우팅 프로토콜: 거리를 기반으로 최적의 경로를 찾는 라우팅 프로토콜
    - 거리: 패킷이 경유한 라우터의 수 (홉의 수)
    - 인접한 라우터끼리 주기적으로 경로 정보를 교환하며 라우팅 테이블을 갱신 → 특정 목적지까지 도달하기까지의 홉 수를 알 수 있음
    - '홉 수가 가장 적은 경로'를 최적의 경로라고 판단 ➡️ 홉 수가 적을수록 라우팅 테이블상의 메트릭 값도 작아짐
  - 2️⃣ OSPF (Open Shortest Path First)
    - 링크 상태 (link state) 라우팅 프로토콜
    - 링크 정보를 비롯한 현재 네트워크의 상태를 그래프 형태로 링크 상태 데이터 베이스 (LSDB: Link State DataBase)에 저장: 라우터들의 연결 관계, 연결 비용 등 현재의 네트워크의 상태를 그래프로 표현하기 위한 데이터가 저장
    - 링크 상태 데이터베이스를 기반으로 현재 네트워크 구성을 마치 지도처럼 그린 뒤 최적의 경로를 선택
    - 대역폭을 기반으로 메트릭 계산 ➡️ 대역폭이 높은 링크일수록 매트릭이 낮은 경로
    - 네트워크 구성이 변경되었을 때 라우팅 테이블 갱신
    - AS를 에어리어(area)라는 단위로 나누고, 구분된 에어리어 내에서만 링크 상태를 공유
    - 에어리어 경계에 있는 ABR (Area Border Router) 이라는 라우터가 에어리어 간 연결을 담당
- EGP (Exterior Gateway Protocol): AS 외부에서 수행
  - 3️⃣ BGP (Border Gateway Protocol)
    - AS 간 통신 (eBGP; external BGP) & AS 내 라우터 간 통신 (iBGP; internal BGP) 에서 사용 가능
    - 피어 (peer): AS 간 정보를 주고받기 위해 BGP 메시지를 주고받을 수 있도록 연결된 eBGP 라우터
    - 피어링 (peering): 피어 관계가 되도록 연결되는 과정
    - RIP와 OSPF에 비해 최적의 경로를 결정하는 과정이 복잡하고, 일정하는 경우가 많음 ⬅️ 속성 (attribute)와 정책 (policy)
      - 속성 (attribute): 경로에 대한 일종의 부과 정보
        - AS-PATH 속성
          - 메시지가 수신지에 이르는 과정에서 통하는 AS들의 목록
          - 메시지가 AS를 거칠 때마다 AS-PATH에는 거쳐 간 AS가 추가
          - BGP (eBGP)의 특징
            - AS 간 라우팅을 할 때 거치게 될 '라우터'의 수가 아닌 'AS'의 수를 고려: AS-PATH의 길이가 더 짧은 경로라고 할지라도 홉 수가 더 많을 수 있음
            - RIP처럼 단순히 수신지에 이르는 '거리'가 아닌, 메시지가 어디를 거쳐 어디로 이동하는지 나타내는 경로를 고려 ⬅️ 순환(loop) 방지 목적. 자신의 AS가 AS-PATH에 포함되어 있을 경우 해당 메시지 폐기
        - NEXT-HOP 속성
          - 다음 홉, 다음으로 거칠 라우터의 IP 주소
        - LOCAL-PREF 속성
          - 지역 선호도 (LOCAL PREFerence)
          - AS 외부 경로에 있어 AS 내부에서(local) 어떤 경로를 선택할지(preference)에 대한 척도를 나타내는 속성
          - AS-PATH나 NEXT-HOP 속성보다 우선시
          - LOCAL-PREF 값이 클수록 우선으로 선택
          - AS 관리 주체가 설정하는 정책의 영향을 받음
      - 정책
        - AS 관리 주체에 따라 각기 다른 상업적·정치적 목적으로 상이한 정책을 사용할 수 있기에 최적의 경로를 선택하는 기준은 AS마다 다를 수 있음 
