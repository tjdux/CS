## 가용성
### 안정성
- 특정 기능을 언제든 균일한 성능으로 수행할 수 있는 특성
### 가용성
- 안정성을 수치화
- 컴퓨터 시스템이 특정 기능을 실제로 수행할 수 있는 시간의 비율
- 전체 사용 시간 중에서 정상적인 사용 시간
- 가용성 = (업타임) / (업타임 + 다운타임)
  - 업타임(uptime): 정상적인 사용 시간
  - 다운타임(downtime): 정상적인 사용이 불가능한 시간
- 가용성이 높다 === 전체 사용 시간 중에서 대부분을 사용 가능
  - "가용성이 높다" === 고가용성 (HA; High Availability)
  - 고가용성을 유지하는 것이 모든 웹 서비스 업체들의 큰 목표
  - 일반적으로 안정적이라고 평가받는 시스템은 가용성 99.999% 이상이 목표
- 가용성을 높이기 위해서는 다운타임을 낮추어야 함
- 핵심은 문제가 발생하더라도 계속 기능할 수 있도록 설계하는 것
  - 결함 감내 (fault tolerance): 문제가 발생하더라도 기능할 수 있는 능력
  - 결함을 감내할 수 있도록 서비스나 인프라를 설계하는 것이 중요
<br/>

## 이중화
### 이중화
- 무언가를 이중으로 두는 기술
- 예비(백업)을 마련하는 방법
- 결함을 감내하여 가용성을 높이기 위한 가장 기본적이고 대표적인 방법
- 물리적 장비, 소프트웨어 모두 이중화 할 수 있는 대상
- 이중화 할 수 있는 대상의 공통점: 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상
- 단일 장애점 (SPOF; Single Point Of Failure)
  - 문제가 발생할 경우 시스템 전체가 중단될 수 있는 대상
  - 가용성을 높이기 위해서는 SPOF를 이중화해야 함
### 이중화 구성 방식
- 액티브 / 스탠바이 (active-standby)
  - 한 시스템은 가동하고, 다른 시스템은 백업 용도로 대기 상태(스탠바이)로 두는 이중화 구성 방식
  - 액티브 상태인 시스템에 문제가 발생할 경우 스탠바이 시스템이 자동으로 액티브 시스템을 대신하여 동작
    - 페일오버 (failover): 액티브 시스템에 문제가 생겼을 경우 예비된 스탠바이 시스템으로 자동 전환되는 기능 
  - 안전한 구성 방식
  - 하나의 장비를 사용할 때에 비해 성능상의 큰 변화를 기대하기는 어려움
- 액티브 / 액티브 (active-active)
  - 두 시스템 모두를 가동 상태로 두는 이중화 구성 방식
  - 부하를 분산시킬 수 있고, 두 시스템이 함께 가동되므로 성능상의 이점
  - 한 시스템에 문제가 발생하면 순간적으로 다른 시스템에 부하가 급증할 수 있어 추가적인 문제 발생 가능성
### 다중화
  - 무언가를 여러 개 두는 기술
  - 이중화된 구성에 비해 더욱 안정적인 운영 가능
### 다중화 / 이중화의 사례 
  - 티밍 (teaming), 본딩 (bonding)
  - 전자는 주로 윈도우, 후자는 주로 리눅스에서 사용되는 용어
  - 여러 개의 네트워크 인터페이스 (NIC)를 이중화 / 다중화하여 마치 더 뛰어나고 안정적인 성능을 보유한 하나의 인터페이스처럼 보이게 하는 기술
<br/>

## 로드 밸런싱 
### 트래픽 (traffic)
- 고가용성을 요구하는 호스트는 클라이언트보다는 일반적으로 서버 ➡️ 서버 입장에서 가용성을 생각해보면...
- 다중화를 했더라도 트래픽 분배 문제를 해결해야 함
- 트래픽은 서버의 가용성에 큰 영향을 끼치는 요소
- 트래픽 (traffic): 주어진 시점에 특정 노드를 경유한 패킷의 양
- 과도한 트래픽은 서버의 가용성을 떨어뜨림
- 서버를 다중화했더라도 트래픽을 고르게 분산해야 가용성이 높아짐
### 로드 밸런싱 (load balancing)
- 트래픽의 고른 분배를 위해 사용되는 기술
- 로드 밸런서 (load balancer)에 의해 수행
- 클라이언트는 로드 밸런서에 요청을 보내고, 로드 밸런서는 해당 요청을 각 서버에 균등하게 분배
### 로드 밸런서 (load balancer)
- L4 스위치, L4 스위치라 불리는 네트워크 장비로도 수행
  - L4 스위치: 주로 IP 주소와 포트 번화와 같은 전송 계층까지의 정보를 바탕으로 로드 밸런싱을 수행
  - L7 스위치: URI, HTTP 메시지 일부, 쿠키 등 응용 계층의 정보까지 활용하여 로드 밸런싱을 수행
- 로드 밸런싱 기능을 제공하는 소프트웨어를 설치하면 일반 호스트도 로드 밸런서로 사용 가능
- 주로 이중화나 다중화된 서버와 클라이언트 사이에 위치
- 서버의 상태 검사
  - 헬스 체크 (health check)
    - 다중화된 서버 환경에서 현재 문제가 있는 서버는 없는지, 현재 요청에 대해 올바른 응답을 할 수 있는 상태인지를 주기적으로 검사
    - 주로 로드 밸런서에 의해 수행
    - HTTP, ICMP 등 다양한 프로토콜을 활용 가능
  - 하트비트 (heartbeat)
    - 서버 간에 하트비트라는 메시지를 주기적으로 주고받는 방법
    - 서버끼리 주기적으로 하트비트 메시지를 주고받다가, 신호가 끊겼을 때 문제 발생을 감지하는 방법
### 로드 밸런싱 알고리즘
- 라운드 로빈 알고리즘 (round robin algorithm): 단순히 서버를 돌아가며 부하를 전달
- 최소 연결 알고리즘 (least connection algorithm): 연결이 적은 서버부터 우선적으로 부하를 전달
- 무작위, 해시 자료구조 이용, 응답 시간이 가장 짧은 서버 선택
- 가중치 부여
  - 서버마다 가중치를 부여하여 알고리즘에 따라 작동하되, 가중치가 높은 서버가 더 많이 선택되어 더 많은 부하를 받도록 하는 것
  - 가중치 라운드 로빈 알고리즘 (weighted round robin algorithm), 가중치 최소 연결 알고리즘 (weighted least connection algorithm)
  - 서버 간 성능이 다른 경우에는 주로 가중치가 적용된 알고리즘을 사용
<br/>

## 포워드 프록시와 리버스 프록시
### 오리진 서버 (origin server)
- 클라이언트가 최종적으로 메시지를 주고받는 대상
- 자원을 생성하고 클라이언트에게 권한 있는 응답을 보낼 수 있는 HTTP 서버
- 클라이언트와 오리진 서버 사이에는 많은 중간 서버가 존재
- 인바운드 (inbound) 메시지: 오리진 서버를 향하는 메시지
- 아웃바운드 (outbound) 메시지: 클라이언트를 향하는 메시지
### 프록시 (proxy)
- 포워드 프록시라고도 부름
- **클라이언트가 선택한** 메시지 전달 대리자
- 오리진 서버보다 클라이언트와 더 가까이 위치
- 주로 캐시 저장, 클라이언트 암호화 및 접근 제한 등의 기능을 제공
### 게이트웨이 (gateway)
- 리버스 프록시라고도 부름
- **아웃바운드 연결에 대해 오리진 서버 역할**을 하지만, 수신된 요청을 변환하여 다른 인바운드 서버(들)로 전달하는 중개자 역할
- 네트워크 외부에서 보면 오리진 서버와 같이 보이지만, 게이트웨이에 요청을 보내면 오리진 서버에게 요청을 전달
- 오리진 서버(들)에 더 가까이 위치
- 캐시를 저장할 수 있고, 로드 밸런서로 동작할 수 있음 
