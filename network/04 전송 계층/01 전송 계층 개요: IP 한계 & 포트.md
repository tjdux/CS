- 전송 계층
  - IP의 한계 극복: 신뢰할 수 있는 통신 & 연결형 통신 가능
  - 응용 계층의 애플리케이션 프로세스 식별: 포트 번호
<br/>

## IP의 한계 
- 1️⃣ 신뢰할 수 없는 (비신뢰성) 프로토콜 (unreliable protocol)
  - IP 프로토콜이 패킷이 수신지까지 제대로 전송되었다는 보장을 하지 않는 특징
  - 통신 과정에서 패킷의 데이터가 손상되거나 중복된 패킷이 전송되었더라도 이를 확인하지 않고, 재전송도 하지 않으며, 순서대로 패킷이 도착할 것이라는 보장 ❌
  - 최선형 전달 (best effort delivery)라고도 함: '최선을 다해 보겠지만, 전송 결과에 대해서는 어떠한 보장도 하지 않는다.'
- 2️⃣ 비연결형 통신 (connectionless protocol)
  - 송수신 호스트 간에 사전 연결 수립 작업을 거치지 않는 특징
  - 그저 수신지를 향해 패킷을 보내기만 할 뿐
- IP 프로토콜이 신뢰할 수 없는 프로토콜 & 비연결형 통신을 하는 이유
  - 성능을 위해서 
  - 패킷이 제대로 전송되었는지 일일이 확인하고, 호스트간 연결을 수립하는 작업은 패킷의 빠른 송수신과는 배치되는 작업
<br/>

## IP의 한계를 극복하는 전송 계층
- TCP
  - 신뢰성 있는 통신 가능
    - 패킷이 수신지까지 올바른 순서대로 확실히 전달되는 것을 보장
    - 재전송을 통한 오류 제어, 흐름 제어, 혼잡 제어 등 다양한 기능들을 제공
  - 연결형 통신 가능
    - 두 호스트가 정보를 주고받기 전에 마치 가상의 회선을 설정하듯이 연결을 수립
    - 송수신하는 동안에는 연결을 유지하고, 송수신이 끝나면 연결을 종료
- UDP
  - 신뢰할 수 없는 통신, 비연결형 통신을 가능하게 하는 전송 계층의 프로토콜
  - 때로는 성능을 위해 신뢰할 수 없는 통신, 비연결형 통신을 지원하는 프로토콜이 필요할 때가 있음 (e.g. 동영상 스트리밍 서비스)
  - TCP보다 빠른 전송
<br/>

## 응용 계층과의 연결 다리, 포트
- 포트의 정의
  - 패킷의 최종 수신 대상은 특정 애플리케이션 프로세스
  - 포트: 패킷이 실행 중인 특정 애플리케이션까지 전달되기 위해 특정 애플리케이션을 식별할 수 있는 정보
- **포트의 분류**
  - 포트 번호
    - 포트 번호를 통해 특정 애플리케이션 식별
    - 패킷 내 수신지 포트, 송신지 포트가 명시
    - 16비트로 표현 가능: 사용 가능한 포트의 수는 $$2^{16}$$(65536) (0번 - 65535번)
  - 포트 번호 분류
    |포트 종류|포트 번호 범위|설명|
    |---|---|---|
    |잘 알려진 포트<br/>(well known port)|0 ~ 1023|범용적으로 사용되는 애플리케이션 프로토콜이 일반적으로 사용하는 '널리 알려진, 유명한' 포트|
    |등록된 포트<br/>(registered port)|1024 ~ 49151|잘 알려진 포트에 비해서는 덜 범용적이지만, 흔히 사용되는 애플리케이션 프로토콜에 할당|
    |동적 포트<br/>(dynamic port)|49152 ~ 65535|자유롭게 사용 가능|
    - 잘 알려진 포트 예시
      |잘 알려진 포트 번호|설명|
      |---|---|
      |20, 21|FTP|
      |22|SSH|
      |23|TELNET|
      |53|DNS|
      |67, 68|DHCP|
      |80|HTTP|
      |443|HTTPS|
    - 등록된 포트 예시
      |등록된 포트 번호|설명|
      |---|---|
      |1194|OpenVPN|
      |1433|Microsoft SQL Server 데이터베이스|
      |3306|MySQL 데이터베이스|
      |6379|Redis|
      |8080|HTTP 대체|
    - 잘 알려진 포트, 등록된 포트는 인터넷 할당 번호 관리 기관(IANA)에 의해 할당
    - 서버로 동작하는 프로그램: 잘 알려진 포트와 등록된 포트로 동작하는 경우가 많음
    - 클라이언트로 동작하는 프로그램: 동적 포트 번호 중 임의의 번호가 할당되는 경우가 많음
- **<IP 주소: 포트 번호> 형식**:IP주소 + 포트 번호 => 특정 호스트에서 실행 중인 특정 애플리케이션 프로세스 식별 가능
<br/>

## 포트 기반 NAT
- NAT
  - IP 주소를 변환하는 기술
  - 주로 네트워크 내부에서 사용되는 사설 IP 주소 ↔ 네트워크 외부에서 사용되는 공인 IP 주소 변환에 사용
  - NAT 변환 테이블 사용
- NAT 변환 테이블
  |네트워크 외부|네트워크 내부|
  |---|---|
  |1.2.3.4|192.168.0.5|
  |1.2.3.5|192.168.0.6|
  |...|...|
  - 변환의 대상이 되는 IP 주소 쌍이 명시
  - 단점: 많은 공인 IP 주소가 필요
    - 변환이 되는 IP 주소가 일대일로 대응: 사설 IP 주소 하나당 공인 IP 주소 하나가 대응
    - 사설 IP 주소만큼 공인 IP 주소 필요 
  - 오늘날에는 다수의 사설 IP 주소를 그보다 적은 수의 공인 IP 주소로 변환
- NAPT
  - 포트 기반의 NAT
  - 포트를 활용해 하나의 공인 IP 주소를 여러 사설 IP 주소가 공유할 수 있도록 하는 NAT의 일종
  - 변환할 IP 주소 쌍과 더불어 포트 번호도 함께 기록하고 변환
  
  |네트워크 외부|네트워크 내부|
  |---|---|
  |1.2.3.4:6200|192.168.0.5:1025|
  |1.2.3.5:6201|192.168.0.6:1026|
  |...|...|
  - 네트워크 외부에서 사용하는 IP 주소가 같더라도 포트 번호가 다르면 네트워크 내부의 호스트 특정 가능
  - 네트워크 내부에서 사용할 IP 주소와 네트워크 외부에서 사용할 IP 주소를 N:1로 관리 가능
  - 공인 IP 주소 수 부족 문제를 개선 
